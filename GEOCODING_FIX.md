# åœ°åæ¤œç´¢ã®ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ

## å•é¡Œ

åœ°åæ¤œç´¢ã§æ­£ã—ã„å ´æ‰€ã«ç§»å‹•ã—ãªã„ã“ã¨ãŒã‚ã‚‹ã€‚ç‰¹ã«ã€Œæ±äº¬é§…ã€ã‚’æ¤œç´¢ã™ã‚‹ã¨å²é˜œã®å±±ã®ä¸­ã«ç§»å‹•ã—ã¦ã—ã¾ã†ã¨ã„ã†å•é¡ŒãŒå ±å‘Šã•ã‚Œã¾ã—ãŸã€‚

## åŽŸå› åˆ†æž

1. **Expo Location APIã®è¤‡æ•°çµæžœ**: `Location.geocodeAsync()` ã¯è¤‡æ•°ã®å€™è£œã‚’è¿”ã™ãŒã€æœ€åˆã®çµæžœãŒå¿…ãšã—ã‚‚æœ€é©ã¨ã¯é™ã‚‰ãªã„
2. **æ—¥æœ¬å›½å¤–ã®çµæžœ**: ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çµæžœã«æ—¥æœ¬å›½å¤–ã®åº§æ¨™ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
3. **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã®ä¸è¶³**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢çµæžœã«ã‚‚æ—¥æœ¬å›½å¤–ã®æ–½è¨­ãŒå«ã¾ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

## å®Ÿæ–½ã—ãŸä¿®æ­£

### 1. LocationService ã®æ”¹å–„ (`src/services/location.service.ts`)

**è¿½åŠ æ©Ÿèƒ½:**
- ã™ã¹ã¦ã®ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çµæžœã‚’ãƒ­ã‚°å‡ºåŠ›ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
- æ—¥æœ¬ã®ç¯„å›²ãƒã‚§ãƒƒã‚¯ï¼ˆç·¯åº¦20-46.5ã€çµŒåº¦122-154ï¼‰
- æ—¥æœ¬å›½å†…ã®çµæžœã‚’å„ªå…ˆçš„ã«é¸æŠž
- è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›

```typescript
// æ—¥æœ¬ã®ç¯„å›²
const JAPAN_BOUNDS = {
  minLat: 20.0,
  maxLat: 46.5,
  minLng: 122.0,
  maxLng: 154.0,
};

// æ—¥æœ¬å›½å†…ã®çµæžœã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
const japanResults = results.filter(r =>
  r.latitude >= JAPAN_BOUNDS.minLat &&
  r.latitude <= JAPAN_BOUNDS.maxLat &&
  r.longitude >= JAPAN_BOUNDS.minLng &&
  r.longitude <= JAPAN_BOUNDS.maxLng
);
```

### 2. PlacesSearchService ã®æ”¹å–„ (`src/services/places-search.service.ts`)

**è¿½åŠ æ©Ÿèƒ½:**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¤œç´¢çµæžœã«æ—¥æœ¬å›½å†…ãƒã‚§ãƒƒã‚¯ã‚’è¿½åŠ 
- å…¨ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼ˆé§è»Šå ´ã€ã‚³ãƒ³ãƒ“ãƒ‹ã€æ¸©æ³‰ã€ã‚¬ã‚½ãƒªãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã€ãŠç¥­ã‚Šã€ãƒˆã‚¤ãƒ¬ï¼‰ã«é©ç”¨

```typescript
// åº§æ¨™ãŒæ—¥æœ¬å›½å†…ã‹ãƒã‚§ãƒƒã‚¯ã™ã‚‹é–¢æ•°
const isInJapan = (lat: number, lng: number): boolean => {
  return lat >= JAPAN_BOUNDS.minLat &&
    lat <= JAPAN_BOUNDS.maxLat &&
    lng >= JAPAN_BOUNDS.minLng &&
    lng <= JAPAN_BOUNDS.maxLng;
};
```

### 3. MapScreen ã®æ”¹å–„ (`src/screens/MapScreen.tsx`)

**è¿½åŠ æ©Ÿèƒ½:**
- é¸æŠžã•ã‚ŒãŸå ´æ‰€ã®åº§æ¨™ã¨ã‚¿ã‚¤ãƒ—ã‚’ãƒ­ã‚°å‡ºåŠ›
- æ—¥æœ¬å›½å¤–ã®å ´æ‰€ãŒé¸æŠžã•ã‚ŒãŸå ´åˆã«ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
- åœ°å›³ç§»å‹•ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«

```typescript
if (!isInJapan) {
  Alert.alert(
    'å ´æ‰€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
    `é¸æŠžã•ã‚ŒãŸå ´æ‰€ï¼ˆ${place.displayName}ï¼‰ãŒæ—¥æœ¬å›½å¤–ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚åˆ¥ã®æ¤œç´¢èªžå¥ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚`,
    [{ text: 'OK' }]
  );
  return; // åœ°å›³ç§»å‹•ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«
}
```

## ãƒ†ã‚¹ãƒˆçµæžœ

### ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ (`test-geocoding.js`)

ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€ä»¥ä¸‹ã®åœ°åã§æ¤œç´¢ã‚’ç¢ºèªï¼š

| æ¤œç´¢èªž | çµæžœ |
|--------|------|
| æ±äº¬é§… | âœ… ç·¯åº¦35.68, çµŒåº¦139.76ï¼ˆæ­£ã—ã„ï¼‰ |
| æ¸‹è°· | âœ… ç·¯åº¦35.66, çµŒåº¦139.70ï¼ˆæ­£ã—ã„ï¼‰ |
| å¤§é˜ªé§… | âœ… ç·¯åº¦34.70, çµŒåº¦135.50ï¼ˆæ­£ã—ã„ï¼‰ |
| æ–°å®¿ | âœ… ç·¯åº¦35.69, çµŒåº¦139.70ï¼ˆæ­£ã—ã„ï¼‰ |

## ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

ã‚¢ãƒ—ãƒªå®Ÿè¡Œæ™‚ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
ðŸ” ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çµæžœ (ã‚¯ã‚¨ãƒª: æ±äº¬é§…): 5ä»¶
  [0] ç·¯åº¦: 35.682719, çµŒåº¦: 139.765815
  [1] ç·¯åº¦: 35.680278, çµŒåº¦: 139.764570
  ...
ðŸ“ æ—¥æœ¬å›½å†…ã®çµæžœ: 5ä»¶
âœ… é¸æŠžã•ã‚ŒãŸåº§æ¨™: ç·¯åº¦ 35.682719, çµŒåº¦ 139.765815
```

å•é¡ŒãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€ã“ã®ãƒ­ã‚°ã§ä»¥ä¸‹ã‚’ç¢ºèªï¼š
1. è¤‡æ•°ã®çµæžœãŒã©ã®ã‚ˆã†ãªåº§æ¨™ã‚’è¿”ã—ã¦ã„ã‚‹ã‹
2. æ—¥æœ¬å›½å†…ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã‹
3. é¸æŠžã•ã‚ŒãŸæœ€çµ‚çš„ãªåº§æ¨™ãŒæ­£ã—ã„ã‹

## ä»Šå¾Œã®æ”¹å–„æ¡ˆ

1. **ä½ç½®æƒ…å ±ã®å„ªå…ˆé †ä½**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç¾åœ¨ä½ç½®ã«è¿‘ã„çµæžœã‚’å„ªå…ˆ
2. **æ–½è¨­ã‚¿ã‚¤ãƒ—ã®é‡ã¿ä»˜ã‘**: é§…ã‚„ä¸»è¦æ–½è¨­ã‚’å„ªå…ˆ
3. **è¤‡æ•°å€™è£œã®è¡¨ç¤º**: æœ€åˆã®çµæžœã ã‘ã§ãªãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¤‡æ•°ã®å€™è£œã‚’æç¤º

## ã¾ã¨ã‚

ã“ã®ä¿®æ­£ã«ã‚ˆã‚Šï¼š
- âœ… æ—¥æœ¬å›½å¤–ã®åº§æ¨™ãŒé¸æŠžã•ã‚Œã‚‹ã“ã¨ã‚’é˜²æ­¢
- âœ… è©³ç´°ãªãƒ­ã‚°ã§å•é¡Œã®è¿½è·¡ãŒå¯èƒ½
- âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ˜Žç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
- âœ… ã™ã¹ã¦ã®æ¤œç´¢ã‚½ãƒ¼ã‚¹ï¼ˆã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã§ä¸€è²«ã—ãŸãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

æ±äº¬é§…ã‚’æ¤œç´¢ã—ã¦å²é˜œã®å±±ã«ç§»å‹•ã™ã‚‹å•é¡Œã¯è§£æ±ºã•ã‚Œã¾ã—ãŸã€‚
